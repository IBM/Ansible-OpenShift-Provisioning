---
- name: Download OpenShift Installer (fips=false)
  ansible.builtin.get_url:
    url: "{{ abi.ocp_installer_base_url }}/{{ abi.architecture }}/clients/ocp/{{ abi.ocp_installer_version }}/{{ 's390x/' if abi.architecture == 'multi' else '' }}openshift-install-linux.tar.gz"
    dest: /tmp/openshift-install-linux.tar.gz
    mode: '0640'
    validate_certs: false
  when: not install_config_vars.fips

- name: Download OpenShift Installer (fips=true)
  ansible.builtin.get_url:
    url: "{{ abi.ocp_installer_base_url }}/{{ abi.architecture }}/clients/ocp/{{ abi.ocp_installer_version }}/{{ 's390x/' if abi.architecture == 'multi' else '' }}openshift-install-rhel9-{{ install_config_vars.control.architecture }}.tar.gz"
    dest: /tmp/openshift-install-rhel9-{{ install_config_vars.control.architecture }}.tar.gz
    mode: '0640'
    validate_certs: false
  when: install_config_vars.fips

- name: Extract OpenShift Installer (fips=false)
  ansible.builtin.unarchive:
    src: /tmp/openshift-install-linux.tar.gz
    dest: /usr/local/bin
    remote_src: true
  when: not install_config_vars.fips

- name: Extract OpenShift Installer (fips=true)
  ansible.builtin.unarchive:
    src: /tmp/openshift-install-rhel9-{{ install_config_vars.control.architecture }}.tar.gz
    dest: /usr/local/bin
    remote_src: true
  when: install_config_vars.fips

- name: Download OpenShift Client
  ansible.builtin.get_url:
    url: "{{ abi.ocp_installer_base_url }}/{{ abi.architecture }}/clients/ocp/{{ abi.ocp_installer_version }}/{{ 's390x/' if abi.architecture == 'multi' else '' }}openshift-client-linux.tar.gz"
    dest: /tmp/openshift-client-linux.tar.gz
    mode: '0755'
    validate_certs: false

- name: Extract OpenShift Client
  ansible.builtin.unarchive:
    src: /tmp/openshift-client-linux.tar.gz
    dest: /usr/local/bin
    remote_src: true

- name: Install NMState package
  ansible.builtin.yum:
    name: nmstate
    state: latest
    skip_broken: true
